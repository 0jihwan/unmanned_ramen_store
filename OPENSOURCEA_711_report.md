# System Design Document

## 7조&11조 - <무인 라면 가게>

### 조원:
#### 1971188 윤동원  
#### 2171073 이경석  
#### 1771178 이남호  
#### 1971111 공지환  
#### 2091006 고민영  
#### 2171222 강현영  

## 목차
1. 서비스 소개   
2. 유사 서비스 분석      
   2-1) 무인 라면 판매점      
   2-2) 무인 편의점   
   
3. 오픈소스 설명      
   3-1) **MembershipReboot**      
   3-2) **PredictionIO**      
   3-3) **Porteus**      
   3-4) **Camera UI**      
   3-5) **Kubernetes Opex Analytics**      
   3-6) **TTS**      
4. DFD & 라이선스 충돌 여부 설명      
    4-1) DFD   
    4-2) 라이선스   
5. 예측 GUI 프로토 타입   
<hr>

### 1. 서비스 소개

 대학가 근처에는 다양한 종류의 음식점이 존재한다. 그 중 24시간 운영하는 음식점도 많았지만 코로나 사태 발발 이후 많이 사라지고 있다.</br>
대학생들은 때때로 공부를 하거나, 친구들을 만나는 등 늦은 시간까지 대학가에 머물러 있는 경우가 있는데 그런 대학생들</br> 그리고 대학가를 찾아오는 많은 사람들을 위한
24시간 무인 운영 라면 판매점을 기획해보았다.</br></br>
<img src="https://github.com/hs-1771178-leenamho/study/blob/main/img/kiosk.jpeg" width="700" height="500"></br>
</br>
 무인으로 운영되는 만큼 점원이 배치되지 않고 키오스크가 배치되어 서비스를 제공한다. </br>
손님들은 매장 내에 비치된 다양한 라면과 토핑의 조합을 키오스크를 통해 주문하고 DIY식으로 직접 조리한다. </br>
키오스크는 손님들이 자주 주문했던 라면과 토핑의 조합을 고객에게 추천해주고</br>
시각장애인 고객인 경우 물리 버튼과 상호작용을 통해 음성 메세지로 안내하는 기능을 가진다.</br>
관리자는 웹페이지를 통해 현재 매장의 상태를 CCTV로 확인하고 시간별 주문량을 그래프로 확인할 수 있다.</br>

</br></br>
<img src="https://github.com/hs-1771178-leenamho/study/blob/main/img/member.png" width="300" height="300"></br>
 이 서비스가 다른 무인 음식 판매점과 가장 큰 차이점은 회원 서비스를 제공해 자사 서비스의 회원인 경우 혜택을 준다는 점이다.</br>
이후 추가적인 보수를 통해 근처 대학가와 제휴를 맺어 해당 대학의 학생들인 경우 추가적인 혜택을 주어, 이를 통한 홍보 효과와 </br>
고객 유치 효과를 기대할 수 있을 것이다.</br>

<hr>

### 2. 유사 서비스 분석
      
2-1) 무인 라면 판매점  
고객이 자판기에서 원하는 라면과 토핑을 구매하여 자신이 원하는 라면을 직접 조리하는 구조이다. </br>
자판기를 통해 모든 서비스를 구성하기 때문에 불편함이 존재한다. </br>
이에 따라 키오스크를 활용하는 더 체계적인 시스템의 필요성을 느꼈다. </br>
또한 대부분의 자판기는 시각, 청각 장애인을 위한 서비스가 제공되지 않아 어려움이 있기에, </br>
이를 보완할 수 있는 음성 메시지 등의 서비스를 활용할 계획이다. </br></br>

2-2) 무인 편의점   
무인 매장에 들어서기 위해 카드가 반드시 필요하다. </br>
카드가 태그되지 않으면 매장 문이 열리지 않는다. </br> 
다만, 마그네틱 카드도 지원이 되므로 해당 페이 기능이 있는 스마트폰을 태그하게 되면 문이 열리는 시스템이다. </br></br>
무인 편의점에 도입된 주요 기술은 머신비전, 전자태그(RFID), 사물인터넷(IoT)이다. </br>
머신비전은 AI 기반 영상으로 고객의 구매 행동을 식별하는 기술이고, </br>
RFID는 반도체 칩이 내장된 태그, 라벨 등의 저장된 데이터를 무선 주파수를 이용하여 비접촉으로 읽어내는 기술이다. </br>
고객은 직접 물건의 바코드를 찍어 구매하게 되고 </br></br>
이때 도난 방지를 위해 결제 뒤에만 태그가 풀리도록 등록해주는 서비스를 이용하거나 회원의 경우 물건을 들고 나가면 자동으로 결제가 되는 서비스가 있다. </br>
미국 아마존고의 '저스트 워크아웃' 기술이 대표적이며 아마존 고와 같은 Cashierless stores 캐쉬어리스 스토어를 열기도 하였다. </br>
IoT 기술을 활용하여 통합 모니터링 시스템을 통해 원격 관리한다는 점에서 참고할만 하다. </br>
<hr>
### 3. 오픈소스 설명

3-1) **MembershipReboot** 

사용자의 ID를 관리하고 인증하는 DB 오픈소스이다. 

이 오픈소스는 최신 ID 관리를 위한 것이기 때문에 Microsoft에서 개발한 Windows 프로그램 오픈소스인 .NET 4.5의 Windows ID Foundation의 클레임 및 일부 관련 개념 사용을 기반으로 한다.

이 오픈소스를 활용하여 사용자가 주문하는 과정에서 회원임을 확인하기 위해 로그인을 하게 된다.

만약 계정이 없다면 키오스크 화면에서 계정을 등록하여 이메일과 비밀번호 설정을 받고, 이는 회원 DB에 저장하게 된다.

이때 새로운 계정이 생성되었다면 관리자는 웹 브라우저를 통해 계정 생성 알림을 받는다.

만약 로그인 도중 여러 번의 오류가 난다면 계정이 잠기고 해당 메일로 오류 텍스트가 보내지는 시스템을 통해 사용자의 계정을 보호한다.

New BSD 라이선스를 사용하였다 

3-2) **PredictionIO**      

머신러닝 기반의 오픈소스이다.

스파크 기반의 예측 분석을 제공하고, (데이터를 이벤트 서버로 보내 모델을 훈련하고, 이후 해당 모델을 기반으로 한) 예측용 엔진을 구성한다. 

이 오픈소스가 엘라스틱 서치를 사용하는데 엘라스틱 서치가 정책변경으로 인해 AWS의 오픈서치로 해당 부분을 수정하였다.

이 오픈소스를 이용하여 토핑 주문 정보를 학습하고 인기 토핑과 리스트를 외부 데이터베이스에 저장하고 이를 고객들에게 추천하는 기능을 수행한다. 

Apache 2.0 라이선스를 사용하였다.

3-3) **Porteus**      

리눅스기반 운영체제로 저렴하고, 다양한 위협으로부터 안전하다는 장점이 있다.

기존의 개방된 단말기는 보안에 취약 하므로 사용자가 주문 이외 다른 행위를 하는 것을 방지한다.

부팅했을 때 자동으로 UI를 오픈해주는 기능을 수행한다. 이를 통해 즉각적인 사용과 관리가 수월해지는 장점을 가진다.

GPL 2.0 라이선스를 사용하였다.

3-4) **Camera UI** 

매장 상태를 알아보기위한 오픈소스이다.

접근성이 뛰어난 GUI 대시보드를 지원하는 이 오픈소스를 통해 실시간 CCTV 조회 및 과거 영상들까지 편안하게 볼 수 있다.

사용한 언어는 vue와 자바 스크립트이다.

이 오픈소스는 또한 다양한 환경에서 지원하는데, 크롬, 파이어폭스 와 같은 브라우저나 안드로이드 ios등등의 핸드폰 os에서도 지원한다.

AWS Rekognition을 이용해 이미지 인식 러닝 후 cctv 스트리밍 영상 중 특정 이미지가 나타나면 해당 영상에 라벨을 남겨 이후 관리자가 쉽게 어떤일이 있었는지 파악할 수 있다.

MIT 라이선스로 작성되었다.

3-5) **Kubernetes Opex Analytics** 

데이터를 차트로 보여주는 오픈소스이다.

이 오픈소스 사용을 위해 kubernetes, docker라는 오픈소스 플랫폼을 사용하였다.

웹브라우저에서 주문량을 보내면 이 오픈소스가 분석하여 다시 웹브라우저로 시각화된 차트를 보내준다.

Apache 2.0 라이선스를 사용하였다.

3-6) **TTS**  

텍스트 데이터를 음성으로 변환하여 시각장애인에게 정보를 전달하는 기능을 수행한다.

해당 오픈소스를 통해 사진을 텍스트로 쪼갠 뒤 정해진 문자형으로 변환하고 이를 정수열로 다시 변환한다. 이후 해당 character로부터 특징을 추출하고 해당 정보를 통해 Mel-spectrogram을 생성한다. 이를 통해 최종적으로 음성으로 합치는 과정을 거친다.

 MIT 라이선스를 사용하였다.

​		

<hr>

### 4. DFD & 라이선스 충돌 여부 설명

4-1) **DFD**

<img src="https://github.com/0jihwan/unmanned_ramen_store/blob/main/DFD/DFD_kiosk.png?raw=true">

키오스크는 부팅 시 메뉴/가격 정보가 저장된 DB로부터 저장되어있는 정보를 가져와 메뉴를 갱신한다.
이후 Porteus OS가 내장된 키오스크를 사용자가 조작한다.
이때 사용자가 매장 이용 외에 웹서핑, 파일 삭제 등 추가로 조작하지 못하도록 Porteus가 방지한다.
관리자는 미리 키오스크의 내용을 텍스트로 TTS 오픈소스에 전달하고 이후 사용자가 키오스크 조작 시 상호작용에 알맞은 텍스트 데이터를 음성 데이터로 변환 후 전송해 키오스크에서 출력한다.
이를 통해 시각장애인도 불편함 없이 키오스크를 이용할 수 있다.

사용자가 메뉴를 선택해 장바구니에 담고 계산 버튼을 조작할 때, PredictionIO가 저장해놓은 토핑 조합 리스트를 읽어오고 마치 버거킹의 키오스크와 유사하게 다른 사용자들이 자주 선택했던 토핑을 추천한다.
이후 회원 여부를 확인하는 창이 나타난다. 이때 MembershipReboot를 활용해 회원 정보를 확인 및 저장한다.
만약 사용자가 회원가입을 할 시 회원 정보 저장 데이터베이스를 갱신한다.
회원 확인이 끝났다면 키오스크는 카드 결제 화면으로 넘어간다.
결제 Timer가 돌아가는 동안 은행에서 OTP를 발급하고, 카드 OTP와 일치하는지 확인한다. 만약 OTP가 불일치하거나 시간초과 혹은 취소 버튼을 누를 시 결제 실패로 넘어가며 Timer에 재요청을 보낸다.

성공적으로 결제했다면 사용자는 전표 수령과 함께 자판기에 준비된 라면과 토핑을 챙겨 DIY식으로 조리한다.
키오스크는 초기 화면으로 돌아가며 내부 상태를 초기화한다.
결제된 제품의 정보는 사용자 선호 결제 정보 저장 DB에 저장되며 이 데이터를 통해 토핑과 라면의 조합의 data를 PredictionIO가 분석 후 토핑 리스트 DB에 저장한다.


<img src="https://github.com/0jihwan/unmanned_ramen_store/blob/main/DFD/DFD_management.png?raw=true">

다음으로 관리자 시점의 DFD를 서술하겠다.

먼저 관리자용 웹브라우저를 개발 후 웹브라우저에 접속하여 모든 관리를 수행한다.
웹브라우저에서 앞서 설명한 회원 정보 저장 DB를 조회해 현재 저장된 회원들을 조사할 수 있고 제품 정보 저장 DB에 저장된 내용들과 저장된 시간 등을 읽어와 큐버넷스를 통해 시각화된 차트 정보를 관리자가 확인한다.
차트 정보를 통해 주문량이 적거나 거의 없는 시간대를 노려 청소, 재고 정리 등을 수행할 수도 있다. 또한 camerui의 GUI 대시보드를 통해 실시간 CCTV 조회가 가능하다.
camerui는 로컬 저장소에 영상 파일 형태로 녹화본을 저장하고 읽어온다.
저장된 영상들은 AWS Rekognition이 사용자 이미지 머신러닝을 통해 인식한 이미지를 라벨 형식으로 동영상에 남겨서 갱신한다.


4-2) **라이선스 충돌여부**

 다른 오픈소스들은 모두 충돌하지 않지만, Porteus의 GPL 2.0 라이선스는 apache 2.0 라이선스를 준수하는 PredictionIO, Kubernetes와 충돌을 일으킬 것이라고 생각할 수도 있다. 하지만 이는 기우이다.
 결론부터 말하자면 Porteus와 PredictionIO, Kubernetes는 별도의 프로그램이므로 충돌이 일어나지 않는다.
Porteus는 키오스크 보안 운영체제를 지원하는 오픈소스이고, PredictionIO와 Kubernetes는 각각 주문 정보를 기반한 머신러닝 오픈소스와 주문량을 차트로 보여주는 오픈소스이다
즉, 두 오픈소스는 라이선스가 통일되어야 하는 것이 아닌 독립적인 프로그램이다.
GPL 2.0 라이선스 문서에는 다음 항목이 명시되어 있다.
‘아래의 "프로그램"은 이러한 프로그램 또는 저작물을 말하며, "프로그램에 기초한 저작물"은 프로그램 또는 저작권법에 따른 파생 저작물을 의미한다. 즉, 프로그램 또는 그 일부를 포함하는 저작물을 말 그대로 또는 수정하거나 다른 언어로 번역한 것을 의미한다.’
따라서 2개 이상의, 별도의 프로그램을 이용하기에 애초에 라이선스 충돌이 발생하지 않는다.

<hr> 

### 5. 예측 GUI 프로토 타입

1.자사의 회원인 경우 혜택을 받을 수 있게 주문 전 회원과 비회원을 선택 할 수 있는 GUI<br>
<img src="https://github.com/minyoungKo/gitkiosk/blob/main/kiosk1.jpg" width="300" heigth="300">
<br><br>
2.라면 설명 텍스트의 번호를 넣어 시각 장애인에게 음성안내를 할 경우 번호로 라면을 선택 할 수 있게 하는 GUI (시각 장애인은 키패드를 통해 라면을 주문 할 수 있다)<br>
<img src="https://github.com/minyoungKo/gitkiosk/blob/main/kiosk2.jpg" width="300" heigth="300">
<br><br>
3.토핑을 선택 할 수 있는 GUI<br>
<img src="https://github.com/minyoungKo/gitkiosk/blob/main/kiosk3.jpg" width="300" heigth="300">
<br><br>
4.주문 전 회원으로 선택 할 경우 할인 쿠폰을 사용할 수 있는 회원 전용 GUI (비회원의 경우 결제화면에서 할인 쿠폰 선택은 제외)<br>
<img src="https://github.com/minyoungKo/gitkiosk/blob/main/kiosk4.jpg" width="300" heigth="300">
